<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Study RPG</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111111">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Study RPG">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Press Start 2P', monospace;
  margin: 0;
  background: linear-gradient(to bottom, #1a1a1a, #111);
  color: #eee;
}
header {
  text-align: center;
  padding: 10px;
  background: #222;
  border-bottom: 2px solid #0f0;
}
header #playerName { font-size: 16px; margin-bottom: 4px; }
header img.sprite {
  border: 2px solid #0f0;
  border-radius: 50%;
  background: #111;
  padding: 4px;
  box-shadow: 0 0 10px #0f0;
  transition: transform 0.5s ease, opacity 0.5s ease;
}
header div { margin-top: 4px; font-size: 14px; }

nav {
  display: flex;
  position: fixed;
  bottom: 0;
  width: 100%;
  background: #222;
  border-top: 2px solid #0f0;
}
nav button {
  flex: 1;
  padding: 10px;
  border: none;
  background: #222;
  color: #aaa;
  font-weight: bold;
}
nav button.active {
  color: #0f0;
  text-shadow: 0 0 5px #0f0;
}

section {
  display: none;
  padding: 16px;
  padding-bottom: 70px;
}
section.active { display: block; }

.card {
  background: linear-gradient(to bottom, #333, #222);
  border: 2px solid #0f0;
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 10px;
  box-shadow: 0 0 10px #0f0;
}

button {
  background: linear-gradient(to bottom, #0f0, #0a0);
  border: 2px solid #080;
  color: #000;
  font-weight: bold;
  padding: 6px 10px;
  border-radius: 4px;
  text-shadow: 0 0 2px #fff;
  cursor: pointer;
  margin-left: 6px;
}
button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 8px #0f0;
}

input, select {
  width: 100%;
  padding: 6px;
  margin-bottom: 6px;
}

#taskList .card {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#daily button {
  background: linear-gradient(to bottom, #ff0, #aa0);
  border: 2px solid #880;
  color: #000;
  font-weight: bold;
  padding: 6px 12px;
  border-radius: 6px;
  text-shadow: 0 0 2px #fff;
  margin-top: 6px;
}

@media (max-width: 600px) {
  header div, header img { font-size: 12px; }
  nav button { font-size: 10px; }
  .card { padding: 10px; }
}
</style>
</head>

<body>

<header>
  <div id="playerName"></div>
  <img id="sprite" src="sprite1.png" alt="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼" class="sprite">
  <div>Lv.<span id="level"></span> EXP:<span id="exp"></span></div>
  <div>ğŸ’° <span id="gold"></span></div>
</header>

<section id="home" class="active">
  <div class="card">
    <h3>ãƒ‡ã‚¤ãƒªãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³</h3>
    <div id="daily"></div>
  </div>
</section>

<section id="tasks">
  <div class="card">
    <input id="taskTitle" placeholder="ã‚¿ã‚¹ã‚¯å">
    <select id="taskDifficulty">
      <option value="1">ç°¡å˜</option>
      <option value="2" selected>æ™®é€š</option>
      <option value="3">é›£ã—ã„</option>
    </select>
    <button onclick="addTask()">è¿½åŠ </button>
  </div>
  <div id="taskList"></div>
</section>

<section id="shop">
  <div class="card">
    <h3>äº¤æ›æ‰€</h3>
    <button onclick="buyBoost()">EXPãƒ–ãƒ¼ã‚¹ãƒˆï¼ˆ50Gï¼‰</button>
  </div>
</section>

<section id="titles">
  <div id="titleList"></div>
</section>

<nav>
  <button class="active" onclick="showTab('home')">ãƒ›ãƒ¼ãƒ </button>
  <button onclick="showTab('tasks')">ã‚¿ã‚¹ã‚¯</button>
  <button onclick="showTab('shop')">äº¤æ›æ‰€</button>
  <button onclick="showTab('titles')">ç§°å·</button>
</nav>

<script>
const today = new Date().toISOString().slice(0,10)

let data = JSON.parse(localStorage.getItem("studyRPG")) || {
  name: "",
  level: 1,
  exp: 0,
  gold: 0,
  boost: 1,
  tasks: [],
  dailyDone: false,
  lastDailyDate: "",
  titles: []
}

if (!data.name) {
  data.name = prompt("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›")
}

if (data.lastDailyDate !== today) {
  data.dailyDone = false
  data.lastDailyDate = today
  save()
}

function save() {
  localStorage.setItem("studyRPG", JSON.stringify(data))
}

function expToNext() { return data.level * 100 }

function spriteByLevel() {
  if (data.level < 5) return "sprite1.png"
  if (data.level < 10) return "sprite2.png"
  return "sprite3.png"
}

function addTask() {
  const titleInput = document.getElementById("taskTitle")
  const diffInput = document.getElementById("taskDifficulty")
  if (!titleInput.value) return
  const task = { title: titleInput.value, difficulty: parseInt(diffInput.value) }
  data.tasks.push(task)
  titleInput.value = ""
  save()
  render()
}

function completeTask(i) {
  const task = data.tasks[i]
  data.tasks.splice(i,1)
  const gain = Math.floor(20 * task.difficulty * data.boost)
  data.exp += gain
  if (data.exp >= expToNext()) {
    data.exp = 0
    data.level++
    if (data.level === 5) data.titles.push("é§†ã‘å‡ºã—å†’é™ºè€…")
    if (data.level === 10) data.titles.push("ç†Ÿç·´å­¦è€…")
  }
  save()
  render()
}

function completeDaily() {
  data.gold += 30
  data.dailyDone = true
  data.lastDailyDate = today
  save()
  render()
}

function buyBoost() {
  if (data.gold < 50) return alert("ã‚´ãƒ¼ãƒ«ãƒ‰ä¸è¶³")
  data.gold -= 50
  data.boost = 2
  save()
  render()
}

function showTab(id) {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"))
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"))
  document.getElementById(id).classList.add("active")
  event.target.classList.add("active")
}

function render() {
  document.getElementById("playerName").textContent = data.name
  document.getElementById("level").textContent = data.level
  document.getElementById("exp").textContent = data.exp + "/" + expToNext()
  document.getElementById("gold").textContent = data.gold

  const spriteEl = document.getElementById("sprite");
  const newSprite = spriteByLevel();
  if (spriteEl.src.indexOf(newSprite) === -1) {
    spriteEl.style.opacity = 0;
    setTimeout(() => {
      spriteEl.src = newSprite;
      spriteEl.style.transform = "scale(1.3)";
      spriteEl.style.opacity = 1;
      setTimeout(() => { spriteEl.style.transform = "scale(1)"; }, 300);
    }, 300);
  }

  const list = document.getElementById("taskList")
  list.innerHTML = ""
  data.tasks.forEach((t, i) => {
    const div = document.createElement("div")
    div.className = "card"
    div.innerHTML = `${t.title} (é›£æ˜“åº¦: ${t.difficulty}) <button onclick="completeTask(${i})">å®Œäº†</button>`
    list.appendChild(div)
  })

  const daily = document.getElementById("daily")
  if (!data.dailyDone) {
    daily.innerHTML = `<button onclick="completeDaily()">ã‚¿ã‚¹ã‚¯1ã¤å®Œäº†</button>`
  } else {
    daily.textContent = "å®Œäº†ï¼"
  }

  const titleList = document.getElementById("titleList")
  titleList.innerHTML = ""
  data.titles.forEach(t => {
    const div = document.createElement("div")
    div.className = "card"
    div.textContent = t
    titleList.appendChild(div)
  })
}

render()
</script>

</body>
</html>
